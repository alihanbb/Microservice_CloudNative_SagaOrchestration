# ğŸ”” Notification Service ve Saga Orchestration Mimarisi

Bu dokÃ¼mantasyon, mikroservis mimarisinde **Notification Service** kullanÄ±mÄ±nÄ± ve **Saga Orchestration** pattern'inin nasÄ±l uygulanacaÄŸÄ±nÄ± detaylÄ± olarak aÃ§Ä±klar.

---

## ğŸ“‹ Ä°Ã§indekiler

1. [Genel BakÄ±ÅŸ](#genel-bakÄ±ÅŸ)
2. [Saga Orchestration Pattern](#saga-orchestration-pattern)
3. [Mimari Diyagramlar](#mimari-diyagramlar)
4. [Notification Service](#notification-service)
5. [Entegrasyon SenaryolarÄ±](#entegrasyon-senaryolarÄ±)
6. [Implementasyon DetaylarÄ±](#implementasyon-detaylarÄ±)
7. [Message Queue YapÄ±sÄ±](#message-queue-yapÄ±sÄ±)

---

## Genel BakÄ±ÅŸ

### Mevcut Mikroservis YapÄ±sÄ±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        MIKROSERVIS MIMARISI                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚   Customer  â”‚   â”‚    Order    â”‚   â”‚   Product   â”‚   â”‚   Backup    â”‚    â”‚
â”‚   â”‚   Service   â”‚   â”‚   Service   â”‚   â”‚   Service   â”‚   â”‚   Service   â”‚    â”‚
â”‚   â”‚             â”‚   â”‚             â”‚   â”‚             â”‚   â”‚             â”‚    â”‚
â”‚   â”‚ SQL Server  â”‚   â”‚  CosmosDB   â”‚   â”‚ SQL Server  â”‚   â”‚ Azure Func  â”‚    â”‚
â”‚   â”‚   :1473     â”‚   â”‚   :8081     â”‚   â”‚   :1473     â”‚   â”‚             â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚   â”‚ Notificationâ”‚   â”‚    YARP     â”‚                                         â”‚
â”‚   â”‚   Service   â”‚   â”‚   Gateway   â”‚                                         â”‚
â”‚   â”‚             â”‚   â”‚             â”‚                                         â”‚
â”‚   â”‚ Azure Func  â”‚   â”‚   :5000     â”‚                                         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Servis Rolleri

| Servis | Teknoloji | Rol |
|--------|-----------|-----|
| **Customer Service** | ASP.NET Core + SQL Server | MÃ¼ÅŸteri yÃ¶netimi (CRUD, DDD) |
| **Order Service** | ASP.NET Core + CosmosDB | SipariÅŸ yÃ¶netimi (CQRS, Event Sourcing) |
| **Product Service** | ASP.NET Core + SQL Server | ÃœrÃ¼n ve stok yÃ¶netimi |
| **Notification Service** | Azure Functions | Bildirim gÃ¶nderimi (Email, SMS, Push) |
| **Backup Service** | Azure Functions | VeritabanÄ± yedekleme |
| **YARP Gateway** | YARP | API Gateway, yÃ¼k dengeleme |

---

## Saga Orchestration Pattern

### Saga Nedir?

**Saga**, daÄŸÄ±tÄ±k sistemlerde birden fazla servisi kapsayan iÅŸlemleri yÃ¶netmek iÃ§in kullanÄ±lan bir pattern'dir. Her servis kendi veritabanÄ±na sahip olduÄŸunda, geleneksel ACID transaction'larÄ± kullanÄ±lamaz.

### Saga Tipleri

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                              â”‚
â”‚   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—   â”‚
â”‚   â•‘     CHOREOGRAPHY              â•‘    â•‘     ORCHESTRATION             â•‘   â”‚
â”‚   â•‘     (Koreografi)              â•‘    â•‘     (Orkestrasyon)            â•‘   â”‚
â”‚   â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£    â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£   â”‚
â”‚   â•‘                               â•‘    â•‘                               â•‘   â”‚
â”‚   â•‘  â€¢ Merkezi kontrol yok        â•‘    â•‘  â€¢ Merkezi orkestratÃ¶r var    â•‘   â”‚
â”‚   â•‘  â€¢ Event-driven               â•‘    â•‘  â€¢ Command-driven             â•‘   â”‚
â”‚   â•‘  â€¢ Servisler event yayÄ±nlar   â•‘    â•‘  â€¢ OrkestratÃ¶r komut gÃ¶nderir â•‘   â”‚
â”‚   â•‘  â€¢ Daha karmaÅŸÄ±k takip        â•‘    â•‘  â€¢ Kolay takip ve debug       â•‘   â”‚
â”‚   â•‘  â€¢ DÃ¶ngÃ¼sel baÄŸÄ±mlÄ±lÄ±k riski  â•‘    â•‘  â€¢ Tek nokta hatasÄ± riski     â•‘   â”‚
â”‚   â•‘                               â•‘    â•‘                               â•‘   â”‚
â”‚   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                              â”‚
â”‚              Bu projede ORCHESTRATION tercih edilmiÅŸtir                     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Saga Orchestration AkÄ±ÅŸÄ±

```
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   SagaOrchestrator  â”‚
                              â”‚   (Azure Function)  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                              â”‚                              â”‚
          â–¼                              â–¼                              â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   Step 1    â”‚              â”‚   Step 2    â”‚              â”‚   Step 3    â”‚
   â”‚  Customer   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶    Order    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶   Product   â”‚
   â”‚  Validate   â”‚              â”‚   Create    â”‚              â”‚   Reserve   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                              â”‚                              â”‚
          â”‚ âœ“ Success                    â”‚ âœ“ Success                    â”‚ âœ“ Success
          â”‚ âœ— Fail                       â”‚ âœ— Fail                       â”‚ âœ— Fail
          â”‚                              â”‚                              â”‚
          â–¼                              â–¼                              â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Compensate: â”‚              â”‚ Compensate: â”‚              â”‚ Compensate: â”‚
   â”‚   (none)    â”‚              â”‚ Cancel Orderâ”‚              â”‚Release Stockâ”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Mimari Diyagramlar

### 1. SipariÅŸ OluÅŸturma Saga Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          SÄ°PARÄ°Å OLUÅTURMA SAGA                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                      â”‚
â”‚  Client                                                                              â”‚
â”‚    â”‚                                                                                 â”‚
â”‚    â”‚ 1. POST /api/orders                                                            â”‚
â”‚    â–¼                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                            â”‚
â”‚  â”‚     API Gateway     â”‚                                                            â”‚
â”‚  â”‚       (YARP)        â”‚                                                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                            â”‚
â”‚             â”‚                                                                        â”‚
â”‚             â”‚ 2. Route to Order Service                                             â”‚
â”‚             â–¼                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                            â”‚
â”‚  â”‚                     â”‚                                                            â”‚
â”‚  â”‚    Order Service    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚                     â”‚                                          â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚                â”‚
â”‚             â”‚                                                      â”‚                â”‚
â”‚             â”‚ 3. Publish: OrderCreatedEvent                       â”‚                â”‚
â”‚             â–¼                                                      â”‚                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚                â”‚
â”‚  â”‚                     â”‚                                          â”‚                â”‚
â”‚  â”‚  Azure Service Bus  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚                â”‚
â”‚  â”‚   (Message Queue)   â”‚                   â”‚                     â”‚                â”‚
â”‚  â”‚                     â”‚                   â”‚                     â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚                     â”‚                â”‚
â”‚             â”‚                               â”‚                     â”‚                â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚                     â”‚                â”‚
â”‚    â”‚                 â”‚              â”‚      â”‚                     â”‚                â”‚
â”‚    â–¼                 â–¼              â–¼      â”‚                     â”‚                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                    â”‚                â”‚
â”‚  â”‚Customer â”‚    â”‚ Product â”‚   â”‚   Saga    â”‚â”‚                    â”‚                â”‚
â”‚  â”‚ Service â”‚    â”‚ Service â”‚   â”‚Orchestratorâ”‚                    â”‚                â”‚
â”‚  â”‚         â”‚    â”‚         â”‚   â”‚(Az.Func)  â”‚â”‚                    â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜â”‚                    â”‚                â”‚
â”‚       â”‚              â”‚              â”‚      â”‚                     â”‚                â”‚
â”‚       â”‚4.Validate    â”‚5.Reserve     â”‚      â”‚                     â”‚                â”‚
â”‚       â”‚  Customer    â”‚  Stock       â”‚      â”‚                     â”‚                â”‚
â”‚       â”‚              â”‚              â”‚      â”‚                     â”‚                â”‚
â”‚       â–¼              â–¼              â–¼      â”‚                     â”‚                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                    â”‚                â”‚
â”‚  â”‚Customer â”‚    â”‚ Product â”‚   â”‚  Update   â”‚â”‚                    â”‚                â”‚
â”‚  â”‚Validatedâ”‚    â”‚ Reservedâ”‚   â”‚Order Stateâ”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚  â”‚ Event   â”‚    â”‚  Event  â”‚   â”‚           â”‚                                       â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚       â”‚              â”‚              â”‚                                              â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
â”‚                      â”‚                                                              â”‚
â”‚                      â”‚ 6. All Steps Complete                                        â”‚
â”‚                      â–¼                                                              â”‚
â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚             â”‚                     â”‚                                                â”‚
â”‚             â”‚ Notification Serviceâ”‚                                                â”‚
â”‚             â”‚   (Azure Function)  â”‚                                                â”‚
â”‚             â”‚                     â”‚                                                â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚                        â”‚                                                            â”‚
â”‚                        â”‚ 7. Send Notifications                                      â”‚
â”‚                        â–¼                                                            â”‚
â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚             â”‚  ğŸ“§ Email  â”‚  ğŸ“± SMS  â”‚  ğŸ”” Push    â”‚                               â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Compensating Transaction (Geri Alma)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SÄ°PARÄ°Å BAÅARISIZ - COMPENSATION FLOW                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  â”‚Customer â”‚   â”‚  Order  â”‚   â”‚ Product â”‚   â”‚ Payment â”‚                             â”‚
â”‚  â”‚ Service â”‚   â”‚ Service â”‚   â”‚ Service â”‚   â”‚ Service â”‚                             â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                             â”‚
â”‚       â”‚             â”‚             â”‚             â”‚                                   â”‚
â”‚       â”‚   âœ“         â”‚   âœ“         â”‚   âœ“         â”‚   âœ— FAIL                        â”‚
â”‚       â–¼             â–¼             â–¼             â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  â”‚Customer â”‚   â”‚  Order  â”‚   â”‚  Stock  â”‚   â”‚ Payment â”‚                             â”‚
â”‚  â”‚Validatedâ”‚   â”‚ Created â”‚   â”‚Reserved â”‚   â”‚ Failed  â”‚                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                                                                                      â”‚
â”‚                         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                  â”‚
â”‚                              COMPENSATION BAÅLAT                                     â”‚
â”‚                         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                  â”‚
â”‚                                                                                      â”‚
â”‚       â”‚   â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                                â”‚
â”‚       â”‚             â”‚             â”‚             â”‚                                   â”‚
â”‚       â”‚             â”‚   âŸ²         â”‚   âŸ²         â”‚                                  â”‚
â”‚       â”‚             â–¼             â–¼             â”‚                                   â”‚
â”‚       â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚                                   â”‚
â”‚       â”‚        â”‚ Cancel  â”‚   â”‚ Release â”‚        â”‚                                   â”‚
â”‚       â”‚        â”‚  Order  â”‚   â”‚  Stock  â”‚        â”‚                                   â”‚
â”‚       â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚                                   â”‚
â”‚       â”‚             â”‚             â”‚             â”‚                                   â”‚
â”‚       â–¼             â–¼             â–¼             â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                                   â”‚
â”‚  â”‚                                       â”‚     â”‚                                   â”‚
â”‚  â”‚        Notification Service           â”‚     â”‚                                   â”‚
â”‚  â”‚                                       â”‚     â”‚                                   â”‚
â”‚  â”‚   ğŸ“§ "SipariÅŸiniz iptal edildi"       â”‚     â”‚                                   â”‚
â”‚  â”‚                                       â”‚     â”‚                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                                   â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. State Machine Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           SAGA STATE MACHINE                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                      â”‚
â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚                            â”‚                 â”‚                                       â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚     PENDING     â”‚                                       â”‚
â”‚         â”‚                  â”‚                 â”‚                                       â”‚
â”‚         â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚         â”‚                           â”‚                                                â”‚
â”‚         â”‚                           â”‚ StartSaga                                      â”‚
â”‚         â”‚                           â–¼                                                â”‚
â”‚         â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚         â”‚                  â”‚   VALIDATING    â”‚                                       â”‚
â”‚         â”‚                  â”‚    CUSTOMER     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚         â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚                        â”‚
â”‚         â”‚                           â”‚                       â”‚ CustomerInvalid        â”‚
â”‚         â”‚                           â”‚ CustomerValid         â”‚                        â”‚
â”‚         â”‚                           â–¼                       â”‚                        â”‚
â”‚         â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚                        â”‚
â”‚         â”‚                  â”‚   RESERVING     â”‚              â”‚                        â”‚
â”‚         â”‚                  â”‚     STOCK       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚         â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚           â”‚            â”‚
â”‚         â”‚                           â”‚                       â”‚           â”‚            â”‚
â”‚         â”‚                           â”‚ StockReserved         â”‚           â”‚ OutOfStock â”‚
â”‚         â”‚                           â–¼                       â”‚           â”‚            â”‚
â”‚         â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚           â”‚            â”‚
â”‚         â”‚                  â”‚   PROCESSING    â”‚              â”‚           â”‚            â”‚
â”‚         â”‚                  â”‚    PAYMENT      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚         â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚           â”‚      â”‚     â”‚
â”‚         â”‚                           â”‚                       â”‚           â”‚      â”‚     â”‚
â”‚         â”‚                           â”‚ PaymentSuccess        â”‚           â”‚      â”‚     â”‚
â”‚         â”‚                           â–¼                       â–¼           â–¼      â–¼     â”‚
â”‚         â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚         â”‚                  â”‚                 â”‚     â”‚                             â”‚  â”‚
â”‚         â”‚                  â”‚   COMPLETED     â”‚     â”‚       COMPENSATING          â”‚  â”‚
â”‚         â”‚                  â”‚                 â”‚     â”‚                             â”‚  â”‚
â”‚         â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                           â”‚                           â”‚                    â”‚
â”‚         â”‚                           â”‚                           â”‚ CompensationDone   â”‚
â”‚         â”‚                           â”‚                           â–¼                    â”‚
â”‚         â”‚                           â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚         â”‚                           â”‚              â”‚                 â”‚               â”‚
â”‚         â”‚                           â”‚              â”‚     FAILED      â”‚               â”‚
â”‚         â”‚                           â”‚              â”‚                 â”‚               â”‚
â”‚         â”‚                           â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚         â”‚                           â”‚                       â”‚                        â”‚
â”‚         â”‚                           â–¼                       â–¼                        â”‚
â”‚         â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚         â”‚                  â”‚                                            â”‚            â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚           NOTIFICATION SERVICE             â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                            â”‚                                            â”‚            
â”‚                            â”‚  â€¢ Saga tamamlandÄ± â†’ Onay bildirimi        â”‚            
â”‚                            â”‚  â€¢ Saga baÅŸarÄ±sÄ±z â†’ Hata bildirimi         â”‚            
â”‚                            â”‚                                            â”‚            
â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Notification Service

### Notification Service YapÄ±sÄ±

```
NotificationServices/
â”œâ”€â”€ Functions/
â”‚   â”œâ”€â”€ EmailNotificationFunction.cs       # Email gÃ¶nderimi
â”‚   â”œâ”€â”€ SmsNotificationFunction.cs         # SMS gÃ¶nderimi
â”‚   â”œâ”€â”€ PushNotificationFunction.cs        # Push notification
â”‚   â”œâ”€â”€ SagaEventHandlerFunction.cs        # Saga event'lerini dinler
â”‚   â””â”€â”€ HealthCheckFunction.cs             # SaÄŸlÄ±k kontrolÃ¼
â”‚
â”œâ”€â”€ Services/
â”‚   â”œâ”€â”€ IEmailService.cs                   # Email servis arayÃ¼zÃ¼
â”‚   â”œâ”€â”€ ISmsService.cs                     # SMS servis arayÃ¼zÃ¼
â”‚   â”œâ”€â”€ IPushNotificationService.cs        # Push servis arayÃ¼zÃ¼
â”‚   â”œâ”€â”€ EmailService.cs                    # SMTP/SendGrid implementasyonu
â”‚   â”œâ”€â”€ SmsService.cs                      # Twilio implementasyonu
â”‚   â””â”€â”€ PushNotificationService.cs         # Firebase implementasyonu
â”‚
â”œâ”€â”€ Models/
â”‚   â”œâ”€â”€ NotificationRequest.cs             # Bildirim isteÄŸi
â”‚   â”œâ”€â”€ NotificationResult.cs              # Bildirim sonucu
â”‚   â””â”€â”€ NotificationTemplate.cs            # Åablonlar
â”‚
â”œâ”€â”€ Configuration/
â”‚   â””â”€â”€ NotificationConfiguration.cs       # Ayarlar
â”‚
â”œâ”€â”€ Program.cs
â”œâ”€â”€ appsettings.json
â””â”€â”€ host.json
```

### Notification Tipleri

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           NOTIFICATION TIPLERI                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                                                                             â”‚   â”‚
â”‚   â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                                                      â”‚   â”‚
â”‚   â”‚  â•‘   ğŸ“§ EMAIL        â•‘                                                      â”‚   â”‚
â”‚   â”‚  â•‘                   â•‘                                                      â”‚   â”‚
â”‚   â”‚  â•‘ â€¢ SipariÅŸ onayÄ±   â•‘                                                      â”‚   â”‚
â”‚   â”‚  â•‘ â€¢ Kargo bildirimi â•‘  â”€â”€â–¶  SendGrid / SMTP / Outlook                     â”‚   â”‚
â”‚   â”‚  â•‘ â€¢ Fatura          â•‘                                                      â”‚   â”‚
â”‚   â”‚  â•‘ â€¢ Åifre sÄ±fÄ±rlama â•‘                                                      â”‚   â”‚
â”‚   â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                      â”‚   â”‚
â”‚   â”‚                                                                             â”‚   â”‚
â”‚   â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                                                      â”‚   â”‚
â”‚   â”‚  â•‘   ğŸ“± SMS          â•‘                                                      â”‚   â”‚
â”‚   â”‚  â•‘                   â•‘                                                      â”‚   â”‚
â”‚   â”‚  â•‘ â€¢ OTP doÄŸrulama   â•‘                                                      â”‚   â”‚
â”‚   â”‚  â•‘ â€¢ SipariÅŸ durumu  â•‘  â”€â”€â–¶  Twilio / Azure Communication Services         â”‚   â”‚
â”‚   â”‚  â•‘ â€¢ Acil bildirimlerâ•‘                                                      â”‚   â”‚
â”‚   â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                      â”‚   â”‚
â”‚   â”‚                                                                             â”‚   â”‚
â”‚   â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                                                      â”‚   â”‚
â”‚   â”‚  â•‘   ğŸ”” PUSH         â•‘                                                      â”‚   â”‚
â”‚   â”‚  â•‘                   â•‘                                                      â”‚   â”‚
â”‚   â”‚  â•‘ â€¢ Mobil uygulama  â•‘                                                      â”‚   â”‚
â”‚   â”‚  â•‘ â€¢ Web bildirimi   â•‘  â”€â”€â–¶  Firebase / Azure Notification Hubs            â”‚   â”‚
â”‚   â”‚  â•‘ â€¢ Real-time alert â•‘                                                      â”‚   â”‚
â”‚   â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                      â”‚   â”‚
â”‚   â”‚                                                                             â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Azure Functions Trigger'larÄ±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     NOTIFICATION SERVICE TRIGGERS                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                               â”‚
â”‚   â”‚                 â”‚                                                               â”‚
â”‚   â”‚  Service Bus    â”‚  â”€â”€â–¶  ServiceBusTrigger                                       â”‚
â”‚   â”‚  Queue/Topic    â”‚       â€¢ order-created-queue                                   â”‚
â”‚   â”‚                 â”‚       â€¢ payment-completed-topic                               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â€¢ saga-completed-queue                                  â”‚
â”‚                                                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                               â”‚
â”‚   â”‚                 â”‚                                                               â”‚
â”‚   â”‚  HTTP Request   â”‚  â”€â”€â–¶  HttpTrigger                                             â”‚
â”‚   â”‚                 â”‚       â€¢ POST /api/notifications/send                          â”‚
â”‚   â”‚                 â”‚       â€¢ POST /api/notifications/email                         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â€¢ POST /api/notifications/sms                           â”‚
â”‚                                                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                               â”‚
â”‚   â”‚                 â”‚                                                               â”‚
â”‚   â”‚  Event Grid     â”‚  â”€â”€â–¶  EventGridTrigger                                        â”‚
â”‚   â”‚                 â”‚       â€¢ Blob storage events                                   â”‚
â”‚   â”‚                 â”‚       â€¢ Custom domain events                                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                               â”‚
â”‚                                                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                               â”‚
â”‚   â”‚                 â”‚                                                               â”‚
â”‚   â”‚     Timer       â”‚  â”€â”€â–¶  TimerTrigger                                            â”‚
â”‚   â”‚                 â”‚       â€¢ GÃ¼nlÃ¼k Ã¶zet email                                     â”‚
â”‚   â”‚                 â”‚       â€¢ Rezervasyon hatÄ±rlatma                                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                               â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Entegrasyon SenaryolarÄ±

### Senaryo 1: SipariÅŸ Onay Bildirimi

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SÄ°PARÄ°Å ONAY BÄ°LDÄ°RÄ°MÄ° AKIÅI                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                    â”‚
â”‚  1. Order Service         2. Service Bus          3. Notification Service         â”‚
â”‚                                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚             â”‚         â”‚             â”‚         â”‚                         â”‚     â”‚
â”‚  â”‚   Order     â”‚ publish â”‚  order-     â”‚ consume â”‚   SagaEventHandler      â”‚     â”‚
â”‚  â”‚  Created    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  completed  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚     Function           â”‚     â”‚
â”‚  â”‚             â”‚         â”‚   -topic    â”‚         â”‚                         â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                              â”‚                    â”‚
â”‚                                                              â”‚                    â”‚
â”‚                                                              â–¼                    â”‚
â”‚                                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚                                                  â”‚                         â”‚     â”‚
â”‚                                                  â”‚   Determine Channel     â”‚     â”‚
â”‚                                                  â”‚   (Email, SMS, Push)    â”‚     â”‚
â”‚                                                  â”‚                         â”‚     â”‚
â”‚                                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                              â”‚                    â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                    â”‚                                         â”‚                 â”‚ â”‚
â”‚                    â–¼                                         â–¼                 â–¼ â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          â”‚                 â”‚               â”‚                 â”‚    â”‚              â”‚
â”‚          â”‚  ğŸ“§ SendGrid    â”‚               â”‚  ğŸ“± Twilio      â”‚    â”‚  ğŸ”” Firebase â”‚
â”‚          â”‚     Email       â”‚               â”‚     SMS         â”‚    â”‚     Push     â”‚
â”‚          â”‚                 â”‚               â”‚                 â”‚    â”‚              â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                   â”‚                                 â”‚                    â”‚       â”‚
â”‚                   â–¼                                 â–¼                    â–¼       â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚          â”‚                                                                â”‚     â”‚
â”‚          â”‚  "SayÄ±n Ali YÄ±lmaz, #12345 numaralÄ± sipariÅŸiniz onaylandÄ±."   â”‚     â”‚
â”‚          â”‚                                                                â”‚     â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Senaryo 2: Saga BaÅŸarÄ±sÄ±z - Compensation Bildirimi

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SAGA BAÅARISIZ - BÄ°LDÄ°RÄ°M AKIÅI                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                    â”‚
â”‚  Saga Orchestrator                                                                 â”‚
â”‚        â”‚                                                                           â”‚
â”‚        â”‚ SagaFailed Event                                                          â”‚
â”‚        â–¼                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                              â”‚
â”‚  â”‚                 â”‚                                                              â”‚
â”‚  â”‚   Service Bus   â”‚                                                              â”‚
â”‚  â”‚  saga-failed    â”‚                                                              â”‚
â”‚  â”‚    -queue       â”‚                                                              â”‚
â”‚  â”‚                 â”‚                                                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                              â”‚
â”‚           â”‚                                                                        â”‚
â”‚           â–¼                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚                                                         â”‚                      â”‚
â”‚  â”‚                 Notification Service                    â”‚                      â”‚
â”‚  â”‚                                                         â”‚                      â”‚
â”‚  â”‚   1. Parse SagaFailed event                            â”‚                      â”‚
â”‚  â”‚   2. Get customer details                              â”‚                      â”‚
â”‚  â”‚   3. Select notification template                      â”‚                      â”‚
â”‚  â”‚   4. Send notification(s)                              â”‚                      â”‚
â”‚  â”‚                                                         â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚           â”‚                                                                        â”‚
â”‚           â–¼                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                                             â”‚  â”‚
â”‚  â”‚   ğŸ“§ Email:                                                                 â”‚  â”‚
â”‚  â”‚   â”€â”€â”€â”€â”€â”€â”€â”€                                                                  â”‚  â”‚
â”‚  â”‚   Konu: SipariÅŸiniz Ä°ÅŸlenemedi                                             â”‚  â”‚
â”‚  â”‚                                                                             â”‚  â”‚
â”‚  â”‚   SayÄ±n [MÃ¼ÅŸteri AdÄ±],                                                     â”‚  â”‚
â”‚  â”‚                                                                             â”‚  â”‚
â”‚  â”‚   [SipariÅŸ No] numaralÄ± sipariÅŸiniz aÅŸaÄŸÄ±daki nedenle tamamlanamadÄ±:       â”‚  â”‚
â”‚  â”‚                                                                             â”‚  â”‚
â”‚  â”‚   Hata: [Stok yetersiz / Ã–deme baÅŸarÄ±sÄ±z / ...]                           â”‚  â”‚
â”‚  â”‚                                                                             â”‚  â”‚
â”‚  â”‚   LÃ¼tfen tekrar deneyiniz veya mÃ¼ÅŸteri hizmetleriyle iletiÅŸime geÃ§iniz.   â”‚  â”‚
â”‚  â”‚                                                                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Implementasyon DetaylarÄ±

### 1. Saga Orchestrator (Azure Function)

```csharp
public class SagaOrchestrator
{
    private readonly IServiceBus _serviceBus;
    private readonly ISagaStateStore _stateStore;
    private readonly ILogger<SagaOrchestrator> _logger;

    [Function("StartOrderSaga")]
    public async Task StartOrderSaga(
        [ServiceBusTrigger("order-created-queue")] OrderCreatedEvent @event)
    {
        // 1. Saga state oluÅŸtur
        var saga = new OrderSaga
        {
            SagaId = Guid.NewGuid(),
            OrderId = @event.OrderId,
            CustomerId = @event.CustomerId,
            State = SagaState.Started,
            CreatedAt = DateTime.UtcNow
        };

        // 2. State'i kaydet
        await _stateStore.SaveAsync(saga);

        // 3. Ä°lk adÄ±mÄ± baÅŸlat: Customer validation
        await _serviceBus.PublishAsync(new ValidateCustomerCommand
        {
            SagaId = saga.SagaId,
            CustomerId = @event.CustomerId
        });

        saga.State = SagaState.ValidatingCustomer;
        await _stateStore.SaveAsync(saga);
    }

    [Function("HandleCustomerValidated")]
    public async Task HandleCustomerValidated(
        [ServiceBusTrigger("customer-validated-queue")] CustomerValidatedEvent @event)
    {
        var saga = await _stateStore.GetAsync(@event.SagaId);

        if (@event.IsValid)
        {
            // Sonraki adÄ±m: Stock reservation
            await _serviceBus.PublishAsync(new ReserveStockCommand
            {
                SagaId = saga.SagaId,
                OrderItems = saga.OrderItems
            });

            saga.State = SagaState.ReservingStock;
        }
        else
        {
            // Saga baÅŸarÄ±sÄ±z - Compensation gerekli deÄŸil (ilk adÄ±m)
            saga.State = SagaState.Failed;
            saga.FailureReason = @event.ValidationError;

            // Notification gÃ¶nder
            await _serviceBus.PublishAsync(new SagaFailedEvent
            {
                SagaId = saga.SagaId,
                Reason = @event.ValidationError,
                CustomerId = saga.CustomerId
            });
        }

        await _stateStore.SaveAsync(saga);
    }

    [Function("HandleStockReserved")]
    public async Task HandleStockReserved(
        [ServiceBusTrigger("stock-reserved-queue")] StockReservedEvent @event)
    {
        var saga = await _stateStore.GetAsync(@event.SagaId);

        if (@event.IsReserved)
        {
            // Saga tamamlandÄ±
            saga.State = SagaState.Completed;
            saga.CompletedAt = DateTime.UtcNow;

            // Notification gÃ¶nder
            await _serviceBus.PublishAsync(new SagaCompletedEvent
            {
                SagaId = saga.SagaId,
                OrderId = saga.OrderId,
                CustomerId = saga.CustomerId
            });
        }
        else
        {
            // Compensation baÅŸlat
            saga.State = SagaState.Compensating;

            // Order'Ä± iptal et
            await _serviceBus.PublishAsync(new CancelOrderCommand
            {
                SagaId = saga.SagaId,
                OrderId = saga.OrderId
            });
        }

        await _stateStore.SaveAsync(saga);
    }
}
```

### 2. Notification Service Functions

```csharp
public class SagaEventHandlerFunction
{
    private readonly INotificationService _notificationService;
    private readonly ICustomerService _customerService;
    private readonly ILogger<SagaEventHandlerFunction> _logger;

    [Function("HandleSagaCompleted")]
    public async Task HandleSagaCompleted(
        [ServiceBusTrigger("saga-completed-queue")] SagaCompletedEvent @event)
    {
        _logger.LogInformation("Saga completed: {SagaId}", @event.SagaId);

        // MÃ¼ÅŸteri bilgilerini al
        var customer = await _customerService.GetByIdAsync(@event.CustomerId);

        // Email gÃ¶nder
        await _notificationService.SendEmailAsync(new EmailRequest
        {
            To = customer.Email,
            Subject = $"SipariÅŸiniz OnaylandÄ± - #{@event.OrderId}",
            Template = "order-confirmed",
            Data = new
            {
                CustomerName = customer.FullName,
                OrderId = @event.OrderId,
                OrderDate = DateTime.UtcNow
            }
        });

        // SMS gÃ¶nder (opsiyonel)
        if (!string.IsNullOrEmpty(customer.PhoneNumber))
        {
            await _notificationService.SendSmsAsync(new SmsRequest
            {
                To = customer.PhoneNumber,
                Message = $"SipariÅŸiniz onaylandÄ±! SipariÅŸ No: #{@event.OrderId}"
            });
        }
    }

    [Function("HandleSagaFailed")]
    public async Task HandleSagaFailed(
        [ServiceBusTrigger("saga-failed-queue")] SagaFailedEvent @event)
    {
        _logger.LogWarning("Saga failed: {SagaId}, Reason: {Reason}", 
            @event.SagaId, @event.Reason);

        var customer = await _customerService.GetByIdAsync(@event.CustomerId);

        await _notificationService.SendEmailAsync(new EmailRequest
        {
            To = customer.Email,
            Subject = "SipariÅŸiniz Ä°ÅŸlenemedi",
            Template = "order-failed",
            Data = new
            {
                CustomerName = customer.FullName,
                FailureReason = @event.Reason
            }
        });
    }
}
```

### 3. Email Service Implementation

```csharp
public class EmailService : IEmailService
{
    private readonly EmailConfiguration _config;
    private readonly ILogger<EmailService> _logger;

    public async Task<NotificationResult> SendAsync(EmailRequest request)
    {
        try
        {
            using var client = new SmtpClient(_config.SmtpHost, _config.SmtpPort);
            client.Credentials = new NetworkCredential(_config.Username, _config.Password);
            client.EnableSsl = true;

            var message = new MailMessage
            {
                From = new MailAddress(_config.FromAddress, _config.FromName),
                Subject = request.Subject,
                Body = await RenderTemplateAsync(request.Template, request.Data),
                IsBodyHtml = true
            };
            message.To.Add(request.To);

            await client.SendMailAsync(message);

            _logger.LogInformation("Email sent to {To}", request.To);

            return new NotificationResult
            {
                Success = true,
                NotificationId = Guid.NewGuid(),
                SentAt = DateTime.UtcNow
            };
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Failed to send email to {To}", request.To);
            return new NotificationResult
            {
                Success = false,
                Error = ex.Message
            };
        }
    }
}
```

---

## Message Queue YapÄ±sÄ±

### Azure Service Bus Topics & Queues

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AZURE SERVICE BUS TOPOLOGY                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                    â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚
â”‚  â•‘                              TOPICS                                           â•‘ â”‚
â”‚  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£ â”‚
â”‚  â•‘                                                                               â•‘ â”‚
â”‚  â•‘   order-events-topic                                                          â•‘ â”‚
â”‚  â•‘   â”œâ”€â”€ subscription: saga-orchestrator                                         â•‘ â”‚
â”‚  â•‘   â”œâ”€â”€ subscription: notification-service                                      â•‘ â”‚
â”‚  â•‘   â””â”€â”€ subscription: analytics-service                                         â•‘ â”‚
â”‚  â•‘                                                                               â•‘ â”‚
â”‚  â•‘   customer-events-topic                                                       â•‘ â”‚
â”‚  â•‘   â”œâ”€â”€ subscription: saga-orchestrator                                         â•‘ â”‚
â”‚  â•‘   â””â”€â”€ subscription: notification-service                                      â•‘ â”‚
â”‚  â•‘                                                                               â•‘ â”‚
â”‚  â•‘   payment-events-topic                                                        â•‘ â”‚
â”‚  â•‘   â”œâ”€â”€ subscription: saga-orchestrator                                         â•‘ â”‚
â”‚  â•‘   â””â”€â”€ subscription: notification-service                                      â•‘ â”‚
â”‚  â•‘                                                                               â•‘ â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                                                    â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚
â”‚  â•‘                              QUEUES                                           â•‘ â”‚
â”‚  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£ â”‚
â”‚  â•‘                                                                               â•‘ â”‚
â”‚  â•‘   validate-customer-queue          â”€â”€â–¶  Customer Service                      â•‘ â”‚
â”‚  â•‘   reserve-stock-queue              â”€â”€â–¶  Product Service                       â•‘ â”‚
â”‚  â•‘   process-payment-queue            â”€â”€â–¶  Payment Service                       â•‘ â”‚
â”‚  â•‘   cancel-order-queue               â”€â”€â–¶  Order Service                         â•‘ â”‚
â”‚  â•‘   release-stock-queue              â”€â”€â–¶  Product Service                       â•‘ â”‚
â”‚  â•‘                                                                               â•‘ â”‚
â”‚  â•‘   send-email-queue                 â”€â”€â–¶  Notification Service                  â•‘ â”‚
â”‚  â•‘   send-sms-queue                   â”€â”€â–¶  Notification Service                  â•‘ â”‚
â”‚  â•‘   send-push-queue                  â”€â”€â–¶  Notification Service                  â•‘ â”‚
â”‚  â•‘                                                                               â•‘ â”‚
â”‚  â•‘   saga-completed-queue             â”€â”€â–¶  Notification Service                  â•‘ â”‚
â”‚  â•‘   saga-failed-queue                â”€â”€â–¶  Notification Service                  â•‘ â”‚
â”‚  â•‘                                                                               â•‘ â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Event ve Command Modelleri

```csharp
// Events (GeÃ§miÅŸte olan ÅŸeyler)
public record OrderCreatedEvent(Guid OrderId, Guid CustomerId, List<OrderItem> Items);
public record CustomerValidatedEvent(Guid SagaId, bool IsValid, string? ValidationError);
public record StockReservedEvent(Guid SagaId, bool IsReserved, string? Error);
public record PaymentProcessedEvent(Guid SagaId, bool IsSuccessful, string? Error);
public record SagaCompletedEvent(Guid SagaId, Guid OrderId, Guid CustomerId);
public record SagaFailedEvent(Guid SagaId, string Reason, Guid CustomerId);

// Commands (YapÄ±lmasÄ± gereken ÅŸeyler)
public record ValidateCustomerCommand(Guid SagaId, Guid CustomerId);
public record ReserveStockCommand(Guid SagaId, List<OrderItem> OrderItems);
public record ProcessPaymentCommand(Guid SagaId, decimal Amount, string PaymentMethod);
public record CancelOrderCommand(Guid SagaId, Guid OrderId);
public record ReleaseStockCommand(Guid SagaId, List<OrderItem> OrderItems);
public record SendNotificationCommand(Guid CustomerId, string Type, object Data);
```

---

## Ã–zet

Bu dokÃ¼mantasyon, mikroservis mimarisinde:

1. âœ… **Saga Orchestration Pattern** - DaÄŸÄ±tÄ±k transaction yÃ¶netimi
2. âœ… **Notification Service** - Azure Functions ile bildirim gÃ¶nderimi
3. âœ… **Compensating Transactions** - Hata durumunda geri alma
4. âœ… **Message Queue** - Azure Service Bus ile asenkron iletiÅŸim
5. âœ… **State Machine** - Saga durumu yÃ¶netimi

konularÄ±nÄ± kapsamlÄ± olarak aÃ§Ä±klamaktadÄ±r.

---

## Sonraki AdÄ±mlar

1. **SagaOrchestrator** Azure Function projesini oluÅŸturma
2. **NotificationServices** projesini tamamlama
3. **Azure Service Bus** yapÄ±landÄ±rmasÄ±
4. **MassTransit** entegrasyonu (opsiyonel)
5. **Event Store** implementasyonu (saga state persistence)
