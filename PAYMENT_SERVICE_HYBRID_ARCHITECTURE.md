# ğŸ’³ Payment Service - Hibrit Mimari TasarÄ±mÄ±

Bu dokÃ¼mantasyon, **ASP.NET Core Web API** ve **Azure Functions** kombinasyonu ile Payment Service'in hibrit mimarisini detaylÄ± olarak aÃ§Ä±klar.

---

## ğŸ“‹ Ä°Ã§indekiler

1. [Hibrit Mimari Nedir?](#hibrit-mimari-nedir)
2. [Sistem Mimarisi](#sistem-mimarisi)
3. [Proje YapÄ±landÄ±rmasÄ±](#proje-yapÄ±landÄ±rmasÄ±)
4. [Ä°letiÅŸim AkÄ±ÅŸlarÄ±](#iletiÅŸim-akÄ±ÅŸlarÄ±)
5. [Implementasyon DetaylarÄ±](#implementasyon-detaylarÄ±)
6. [Docker YapÄ±landÄ±rmasÄ±](#docker-yapÄ±landÄ±rmasÄ±)
7. [Deployment Stratejisi](#deployment-stratejisi)

---

## Hibrit Mimari Nedir?

Hibrit yaklaÅŸÄ±m, **ASP.NET Core Web API**'nin gÃ¼Ã§lÃ¼ domain logic ve REST API yeteneklerini **Azure Functions**'Ä±n event-driven ve serverless avantajlarÄ±yla birleÅŸtirir.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              HÄ°BRÄ°T MÄ°MARÄ° YAPISI                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                         â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚                              â”‚        PAYMENT SERVICE                  â”‚                â”‚
â”‚                              â”‚        (Hibrit Mimari)                  â”‚                â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                            â”‚                                            â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚            â”‚                                                               â”‚            â”‚
â”‚            â–¼                                                               â–¼            â”‚
â”‚   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—       â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—     â”‚
â”‚   â•‘                                   â•‘       â•‘                                   â•‘     â”‚
â”‚   â•‘     ASP.NET CORE WEB API          â•‘       â•‘      AZURE FUNCTIONS              â•‘     â”‚
â”‚   â•‘     (PaymentService.Api)          â•‘       â•‘      (PaymentService.Workers)     â•‘     â”‚
â”‚   â•‘                                   â•‘       â•‘                                   â•‘     â”‚
â”‚   â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£       â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£     â”‚
â”‚   â•‘                                   â•‘       â•‘                                   â•‘     â”‚
â”‚   â•‘  â€¢ REST API Endpoints             â•‘       â•‘  â€¢ Service Bus Triggers           â•‘     â”‚
â”‚   â•‘  â€¢ Domain Logic                   â•‘       â•‘  â€¢ Saga Event Handlers            â•‘     â”‚
â”‚   â•‘  â€¢ Validation                     â•‘       â•‘  â€¢ Webhook Handlers               â•‘     â”‚
â”‚   â•‘  â€¢ Complex Business Rules         â•‘       â•‘  â€¢ Timer Triggered Jobs           â•‘     â”‚
â”‚   â•‘  â€¢ Transaction Management         â•‘       â•‘  â€¢ Event Processing               â•‘     â”‚
â”‚   â•‘                                   â•‘       â•‘                                   â•‘     â”‚
â”‚   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•       â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•     â”‚
â”‚            â”‚                                                               â”‚            â”‚
â”‚            â”‚                                                               â”‚            â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                        â”‚                                                â”‚
â”‚                                        â–¼                                                â”‚
â”‚                          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                               â”‚
â”‚                          â•‘                              â•‘                               â”‚
â”‚                          â•‘   SHARED BUSINESS LOGIC      â•‘                               â”‚
â”‚                          â•‘   (PaymentService.Core)      â•‘                               â”‚
â”‚                          â•‘                              â•‘                               â”‚
â”‚                          â•‘   â€¢ IPaymentService          â•‘                               â”‚
â”‚                          â•‘   â€¢ IPaymentProvider         â•‘                               â”‚
â”‚                          â•‘   â€¢ IPaymentRepository       â•‘                               â”‚
â”‚                          â•‘   â€¢ Domain Models            â•‘                               â”‚
â”‚                          â•‘                              â•‘                               â”‚
â”‚                          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                               â”‚
â”‚                                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Neden Hibrit?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              HÄ°BRÄ°T AVANTAJLARI                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                         â”‚
â”‚   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—    â”‚
â”‚   â•‘  API KATMANI (ASP.NET Core)                                                    â•‘    â”‚
â”‚   â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£    â”‚
â”‚   â•‘                                                                                â•‘    â”‚
â”‚   â•‘  âœ“ Clean Architecture / DDD uyumlu                                             â•‘    â”‚
â”‚   â•‘  âœ“ KarmaÅŸÄ±k validasyonlar                                                      â•‘    â”‚
â”‚   â•‘  âœ“ Swagger/OpenAPI dokÃ¼mantasyonu                                              â•‘    â”‚
â”‚   â•‘  âœ“ Middleware pipeline (auth, logging, error handling)                         â•‘    â”‚
â”‚   â•‘  âœ“ Rate limiting, caching                                                      â•‘    â”‚
â”‚   â•‘  âœ“ Integration tests kolaylÄ±ÄŸÄ±                                                 â•‘    â”‚
â”‚   â•‘                                                                                â•‘    â”‚
â”‚   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                                                                                         â”‚
â”‚   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—    â”‚
â”‚   â•‘  WORKER KATMANI (Azure Functions)                                              â•‘    â”‚
â”‚   â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£    â”‚
â”‚   â•‘                                                                                â•‘    â”‚
â”‚   â•‘  âœ“ Event-driven processing                                                     â•‘    â”‚
â”‚   â•‘  âœ“ Saga Orchestration entegrasyonu                                             â•‘    â”‚
â”‚   â•‘  âœ“ Otomatik Ã¶lÃ§ekleme                                                          â•‘    â”‚
â”‚   â•‘  âœ“ Retry/Dead-letter handling                                                  â•‘    â”‚
â”‚   â•‘  âœ“ ZamanlanmÄ±ÅŸ iÅŸler (mutabakat, raporlama)                                    â•‘    â”‚
â”‚   â•‘  âœ“ Webhook processing                                                          â•‘    â”‚
â”‚   â•‘                                                                                â•‘    â”‚
â”‚   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Sistem Mimarisi

### Genel Mimari DiyagramÄ±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    SÄ°STEM MÄ°MARÄ°SÄ°                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚   Client    â”‚         â”‚   Gateway   â”‚         â”‚            PAYMENT SERVICE          â”‚       â”‚
â”‚   â”‚   (Web/     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   (YARP)    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                                     â”‚       â”‚
â”‚   â”‚   Mobile)   â”‚         â”‚   :5000     â”‚         â”‚                                     â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚       â”‚
â”‚                                                   â”‚  â”‚                                 â”‚â”‚       â”‚
â”‚                                                   â”‚  â”‚    PaymentService.Api           â”‚â”‚       â”‚
â”‚                                                   â”‚  â”‚    (ASP.NET Core)               â”‚â”‚       â”‚
â”‚                                                   â”‚  â”‚    Port: 5080                   â”‚â”‚       â”‚
â”‚                                                   â”‚  â”‚                                 â”‚â”‚       â”‚
â”‚                                                   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚       â”‚
â”‚                                                   â”‚  â”‚  â”‚ POST /api/payments        â”‚  â”‚â”‚       â”‚
â”‚                                                   â”‚  â”‚  â”‚ GET  /api/payments/{id}   â”‚  â”‚â”‚       â”‚
â”‚                                                   â”‚  â”‚  â”‚ POST /api/payments/refund â”‚  â”‚â”‚       â”‚
â”‚                                                   â”‚  â”‚  â”‚ GET  /api/payments/status â”‚  â”‚â”‚       â”‚
â”‚                                                   â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚       â”‚
â”‚                                                   â”‚  â”‚                                 â”‚â”‚       â”‚
â”‚                                                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚       â”‚
â”‚                                                   â”‚                  â”‚                  â”‚       â”‚
â”‚                                                   â”‚                  â”‚ Internal Call    â”‚       â”‚
â”‚                                                   â”‚                  â”‚ (HTTP/gRPC)      â”‚       â”‚ 
â”‚                                                   â”‚                  â”‚                  â”‚       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚       â”‚
â”‚   â”‚                                             â”‚ â”‚  â”‚                                 â”‚â”‚       â”‚
â”‚   â”‚              SAGA ORCHESTRATOR              â”‚ â”‚  â”‚   PaymentService.Workers        â”‚â”‚       â”‚
â”‚   â”‚              (Azure Function)               â”‚ â”‚  â”‚   (Azure Functions)             â”‚â”‚       â”‚
â”‚   â”‚                                             â”‚ â”‚  â”‚   Port: 7073                    â”‚â”‚       â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚  â”‚                                 â”‚â”‚       â”‚
â”‚   â”‚  â”‚ Order Saga State Machine              â”‚  â”‚ â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚       â”‚
â”‚   â”‚  â”‚                                       â”‚  â”‚ â”‚  â”‚  â”‚ ServiceBusTrigger:        â”‚  â”‚â”‚       â”‚
â”‚   â”‚  â”‚ 1. Validate Customer âœ“                â”‚  â”‚ â”‚  â”‚  â”‚ â€¢ ProcessPaymentHandler   â”‚  â”‚â”‚       â”‚
â”‚   â”‚  â”‚ 2. Create Order âœ“                     â”‚  â”‚ â”‚  â”‚  â”‚ â€¢ RefundPaymentHandler    â”‚  â”‚â”‚       â”‚
â”‚   â”‚  â”‚ 3. Reserve Stock âœ“                    â”‚  â”‚ â”‚  â”‚  â”‚                           â”‚  â”‚â”‚       â”‚
â”‚   â”‚  â”‚ 4. Process Payment â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”¼â”€â”€â”¼â”€â”€â”‚ TimerTrigger:             â”‚  â”‚â”‚       â”‚
â”‚   â”‚  â”‚                                       â”‚  â”‚ â”‚  â”‚  â”‚ â€¢ ReconciliationJob       â”‚  â”‚â”‚       â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚  â”‚  â”‚                           â”‚  â”‚â”‚       â”‚
â”‚   â”‚                                             â”‚ â”‚  â”‚  â”‚ HttpTrigger:              â”‚  â”‚â”‚       â”‚
â”‚   â”‚                                             â”‚ â”‚  â”‚  â”‚ â€¢ WebhookHandler          â”‚  â”‚â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚       â”‚
â”‚                          â”‚                        â”‚  â”‚                                 â”‚â”‚       â”‚
â”‚                          â”‚                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚       â”‚
â”‚                          â”‚                        â”‚                                     â”‚       â”‚
â”‚                          â–¼                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚                                                                                     â”‚       â”‚
â”‚   â”‚                              AZURE SERVICE BUS                                      â”‚       â”‚
â”‚   â”‚                                                                                     â”‚       â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚       â”‚
â”‚   â”‚   â”‚process-payment  â”‚  â”‚ refund-payment  â”‚  â”‚  saga-reply     â”‚                     â”‚       â”‚
â”‚   â”‚   â”‚    -queue       â”‚  â”‚    -queue       â”‚  â”‚    -queue       â”‚                     â”‚       â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚       â”‚
â”‚   â”‚                                                                                     â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚                                                                                     â”‚       â”‚
â”‚   â”‚                              PAYMENT DATABASE                                       â”‚       â”‚
â”‚   â”‚                              (SQL Server / CosmosDB)                                â”‚       â”‚
â”‚   â”‚                                                                                     â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Katman Ä°letiÅŸimi

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              KATMAN Ä°LETÄ°ÅÄ°M DÄ°YAGRAMI                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                         â”‚
â”‚                                                                                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚    â”‚                                                                              â”‚     â”‚
â”‚    â”‚                     PaymentService.Api                                       â”‚     â”‚
â”‚    â”‚                     (ASP.NET Core)                                           â”‚     â”‚
â”‚    â”‚                                                                              â”‚     â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚     â”‚
â”‚    â”‚  â”‚  Controllers/  â”‚  â”‚  Middleware    â”‚  â”‚   Validators   â”‚                  â”‚     â”‚
â”‚    â”‚  â”‚  Endpoints     â”‚  â”‚  Pipeline      â”‚  â”‚                â”‚                  â”‚     â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚     â”‚
â”‚    â”‚          â”‚                                                                   â”‚     â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚               â”‚                                                                         â”‚
â”‚               â–¼                                                                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚    â”‚                                                                              â”‚     â”‚
â”‚    â”‚                     PaymentService.Core                                      â”‚     â”‚
â”‚    â”‚                     (Shared Business Logic)                                  â”‚     â”‚
â”‚    â”‚                                                                              â”‚     â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚     â”‚
â”‚    â”‚  â”‚ IPaymentServiceâ”‚  â”‚IPaymentProviderâ”‚  â”‚ Domain Models  â”‚                  â”‚     â”‚
â”‚    â”‚  â”‚                â”‚  â”‚                â”‚  â”‚                â”‚                  â”‚     â”‚
â”‚    â”‚  â”‚ â€¢ ProcessAsync â”‚  â”‚ â€¢ Stripe       â”‚  â”‚ â€¢ Payment      â”‚                  â”‚     â”‚
â”‚    â”‚  â”‚ â€¢ RefundAsync  â”‚  â”‚ â€¢ PayPal       â”‚  â”‚ â€¢ Transaction  â”‚                  â”‚     â”‚
â”‚    â”‚  â”‚ â€¢ GetByIdAsync â”‚  â”‚ â€¢ Iyzico       â”‚  â”‚ â€¢ Refund       â”‚                  â”‚     â”‚
â”‚    â”‚  â”‚                â”‚  â”‚ â€¢ Dummy        â”‚  â”‚                â”‚                  â”‚     â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚     â”‚
â”‚    â”‚                                                                              â”‚     â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚               â–²                                                                         â”‚
â”‚               â”‚                                                                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚    â”‚          â”‚                                                                   â”‚     â”‚
â”‚    â”‚                     PaymentService.Workers                                   â”‚     â”‚
â”‚    â”‚                     (Azure Functions)                                        â”‚     â”‚
â”‚    â”‚                                                                              â”‚     â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚     â”‚
â”‚    â”‚  â”‚  ServiceBus    â”‚  â”‚    Timer       â”‚  â”‚    HTTP        â”‚                  â”‚     â”‚
â”‚    â”‚  â”‚  Triggers      â”‚  â”‚   Triggers     â”‚  â”‚   Triggers     â”‚                  â”‚     â”‚
â”‚    â”‚  â”‚                â”‚  â”‚                â”‚  â”‚                â”‚                  â”‚     â”‚
â”‚    â”‚  â”‚ â€¢ Saga Cmds    â”‚  â”‚ â€¢ Reconcile    â”‚  â”‚ â€¢ Webhooks     â”‚                  â”‚     â”‚
â”‚    â”‚  â”‚ â€¢ Compensation â”‚  â”‚ â€¢ Reports      â”‚  â”‚                â”‚                  â”‚     â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚     â”‚
â”‚    â”‚                                                                              â”‚     â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚    â”‚                                                                              â”‚     â”‚
â”‚    â”‚                     PaymentService.Infrastructure                            â”‚     â”‚
â”‚    â”‚                     (Data Access, External Services)                         â”‚     â”‚
â”‚    â”‚                                                                              â”‚     â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚     â”‚
â”‚    â”‚  â”‚  Repository    â”‚  â”‚  Service Bus   â”‚  â”‚  Provider      â”‚                  â”‚     â”‚
â”‚    â”‚  â”‚  Implementationâ”‚  â”‚  Client        â”‚  â”‚  Clients       â”‚                  â”‚     â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚     â”‚
â”‚    â”‚                                                                              â”‚     â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Proje YapÄ±landÄ±rmasÄ±

### Solution YapÄ±sÄ±

```
src/services/Payment/
â”‚
â”œâ”€â”€ PaymentService.sln                              # Solution dosyasÄ±
â”‚
â”œâ”€â”€ PaymentService.Core/                            # SHARED BUSINESS LOGIC
â”‚   â”œâ”€â”€ PaymentService.Core.csproj
â”‚   â”œâ”€â”€ Domain/
â”‚   â”‚   â”œâ”€â”€ Entities/
â”‚   â”‚   â”‚   â”œâ”€â”€ Payment.cs
â”‚   â”‚   â”‚   â”œâ”€â”€ Transaction.cs
â”‚   â”‚   â”‚   â””â”€â”€ Refund.cs
â”‚   â”‚   â”œâ”€â”€ Enums/
â”‚   â”‚   â”‚   â”œâ”€â”€ PaymentStatus.cs
â”‚   â”‚   â”‚   â”œâ”€â”€ PaymentMethod.cs
â”‚   â”‚   â”‚   â””â”€â”€ TransactionType.cs
â”‚   â”‚   â”œâ”€â”€ ValueObjects/
â”‚   â”‚   â”‚   â”œâ”€â”€ Money.cs
â”‚   â”‚   â”‚   â”œâ”€â”€ CardInfo.cs
â”‚   â”‚   â”‚   â””â”€â”€ PaymentResult.cs
â”‚   â”‚   â””â”€â”€ Events/
â”‚   â”‚       â”œâ”€â”€ PaymentCreatedEvent.cs
â”‚   â”‚       â”œâ”€â”€ PaymentCompletedEvent.cs
â”‚   â”‚       â””â”€â”€ PaymentFailedEvent.cs
â”‚   â”‚
â”‚   â”œâ”€â”€ Interfaces/
â”‚   â”‚   â”œâ”€â”€ IPaymentService.cs
â”‚   â”‚   â”œâ”€â”€ IPaymentRepository.cs
â”‚   â”‚   â”œâ”€â”€ IPaymentProvider.cs
â”‚   â”‚   â””â”€â”€ IPaymentProviderFactory.cs
â”‚   â”‚
â”‚   â”œâ”€â”€ Services/
â”‚   â”‚   â”œâ”€â”€ PaymentService.cs
â”‚   â”‚   â””â”€â”€ PaymentProviderFactory.cs
â”‚   â”‚
â”‚   â”œâ”€â”€ DTOs/
â”‚   â”‚   â”œâ”€â”€ ProcessPaymentRequest.cs
â”‚   â”‚   â”œâ”€â”€ ProcessPaymentResponse.cs
â”‚   â”‚   â”œâ”€â”€ RefundRequest.cs
â”‚   â”‚   â”œâ”€â”€ RefundResponse.cs
â”‚   â”‚   â””â”€â”€ PaymentDto.cs
â”‚   â”‚
â”‚   â””â”€â”€ Contracts/                                  # Saga Mesaj KontratlarÄ±
â”‚       â”œâ”€â”€ Commands/
â”‚       â”‚   â”œâ”€â”€ ProcessPaymentCommand.cs
â”‚       â”‚   â””â”€â”€ RefundPaymentCommand.cs
â”‚       â””â”€â”€ Replies/
â”‚           â””â”€â”€ PaymentProcessedReply.cs
â”‚
â”œâ”€â”€ PaymentService.Infrastructure/                  # DATA ACCESS & EXTERNAL
â”‚   â”œâ”€â”€ PaymentService.Infrastructure.csproj
â”‚   â”œâ”€â”€ Persistence/
â”‚   â”‚   â”œâ”€â”€ PaymentDbContext.cs
â”‚   â”‚   â”œâ”€â”€ Configurations/
â”‚   â”‚   â”‚   â””â”€â”€ PaymentConfiguration.cs
â”‚   â”‚   â””â”€â”€ Repositories/
â”‚   â”‚       â””â”€â”€ PaymentRepository.cs
â”‚   â”‚
â”‚   â”œâ”€â”€ Providers/
â”‚   â”‚   â”œâ”€â”€ DummyPaymentProvider.cs
â”‚   â”‚   â”œâ”€â”€ StripePaymentProvider.cs
â”‚   â”‚   â”œâ”€â”€ IyzicoPaymentProvider.cs
â”‚   â”‚   â””â”€â”€ PayPalPaymentProvider.cs
â”‚   â”‚
â”‚   â””â”€â”€ ServiceBus/
â”‚       â”œâ”€â”€ ServiceBusPublisher.cs
â”‚       â””â”€â”€ ServiceBusConfiguration.cs
â”‚
â”œâ”€â”€ PaymentService.Api/                             # ASP.NET CORE WEB API
â”‚   â”œâ”€â”€ PaymentService.Api.csproj
â”‚   â”œâ”€â”€ Program.cs
â”‚   â”œâ”€â”€ appsettings.json
â”‚   â”œâ”€â”€ appsettings.Development.json
â”‚   â”‚
â”‚   â”œâ”€â”€ Controllers/
â”‚   â”‚   â””â”€â”€ PaymentsController.cs
â”‚   â”‚
â”‚   â”œâ”€â”€ Endpoints/                                  # Minimal API (alternatif)
â”‚   â”‚   â”œâ”€â”€ PaymentEndpoints.cs
â”‚   â”‚   â””â”€â”€ RefundEndpoints.cs
â”‚   â”‚
â”‚   â”œâ”€â”€ Middleware/
â”‚   â”‚   â”œâ”€â”€ ExceptionHandlingMiddleware.cs
â”‚   â”‚   â””â”€â”€ RequestLoggingMiddleware.cs
â”‚   â”‚
â”‚   â”œâ”€â”€ Validators/
â”‚   â”‚   â”œâ”€â”€ ProcessPaymentRequestValidator.cs
â”‚   â”‚   â””â”€â”€ RefundRequestValidator.cs
â”‚   â”‚
â”‚   â””â”€â”€ Dockerfile
â”‚
â”œâ”€â”€ PaymentService.Workers/                         # AZURE FUNCTIONS
â”‚   â”œâ”€â”€ PaymentService.Workers.csproj
â”‚   â”œâ”€â”€ Program.cs
â”‚   â”œâ”€â”€ host.json
â”‚   â”œâ”€â”€ local.settings.json
â”‚   â”‚
â”‚   â”œâ”€â”€ Functions/
â”‚   â”‚   â”œâ”€â”€ SagaPaymentFunction.cs                 # ServiceBus Trigger
â”‚   â”‚   â”œâ”€â”€ WebhookFunction.cs                     # HTTP Trigger
â”‚   â”‚   â”œâ”€â”€ ReconciliationFunction.cs              # Timer Trigger
â”‚   â”‚   â””â”€â”€ HealthCheckFunction.cs                 # HTTP Trigger
â”‚   â”‚
â”‚   â””â”€â”€ Dockerfile
â”‚
â””â”€â”€ PaymentService.Tests/                           # UNIT & INTEGRATION TESTS
    â”œâ”€â”€ PaymentService.Tests.csproj
    â”œâ”€â”€ Unit/
    â”‚   â”œâ”€â”€ PaymentServiceTests.cs
    â”‚   â””â”€â”€ PaymentProviderTests.cs
    â””â”€â”€ Integration/
        â”œâ”€â”€ ApiIntegrationTests.cs
        â””â”€â”€ SagaIntegrationTests.cs
```

### Proje ReferanslarÄ±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              PROJE BAÄIMLILIKLARI                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                         â”‚
â”‚                                                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                                                                                 â”‚   â”‚
â”‚   â”‚                    PaymentService.Api                                           â”‚   â”‚
â”‚   â”‚                                                                                 â”‚   â”‚
â”‚   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚   â”‚    â”‚  <ProjectReference Include="../Core/PaymentService.Core.csproj" />  â”‚      â”‚   â”‚
â”‚   â”‚    â”‚  <ProjectReference Include="../Infra/PaymentService.Infra.csproj" />â”‚      â”‚   â”‚
â”‚   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚   â”‚                                                                                 â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                        â”‚                                                â”‚
â”‚                                        â”‚                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                                                                                 â”‚   â”‚
â”‚   â”‚                    PaymentService.Workers                                       â”‚   â”‚
â”‚   â”‚                                                                                 â”‚   â”‚
â”‚   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚   â”‚    â”‚  <ProjectReference Include="../Core/PaymentService.Core.csproj" />  â”‚      â”‚   â”‚
â”‚   â”‚    â”‚  <ProjectReference Include="../Infra/PaymentService.Infra.csproj" />â”‚      â”‚   â”‚
â”‚   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚   â”‚                                                                                 â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                        â”‚                                                â”‚
â”‚                                        â–¼                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                                                                                 â”‚   â”‚
â”‚   â”‚                    PaymentService.Core                                          â”‚   â”‚
â”‚   â”‚                    (BaÄŸÄ±mlÄ±lÄ±k yok - merkez)                                    â”‚   â”‚
â”‚   â”‚                                                                                 â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                        â–²                                                â”‚
â”‚                                        â”‚                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                                                                                 â”‚   â”‚
â”‚   â”‚                    PaymentService.Infrastructure                                â”‚   â”‚
â”‚   â”‚                                                                                 â”‚   â”‚
â”‚   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚   â”‚    â”‚  <ProjectReference Include="../Core/PaymentService.Core.csproj" />  â”‚      â”‚   â”‚
â”‚   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚   â”‚                                                                                 â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ä°letiÅŸim AkÄ±ÅŸlarÄ±

### 1. REST API AkÄ±ÅŸÄ± (DoÄŸrudan Ã–deme)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           REST API Ã–DEME AKIÅI                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                         â”‚
â”‚   Client          Gateway       PaymentService.Api          Provider                    â”‚
â”‚     â”‚                â”‚                â”‚                        â”‚                        â”‚
â”‚     â”‚ POST /pay      â”‚                â”‚                        â”‚                        â”‚
â”‚     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                â”‚                        â”‚                        â”‚
â”‚     â”‚                â”‚ Route          â”‚                        â”‚                        â”‚
â”‚     â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                        â”‚                        â”‚
â”‚     â”‚                â”‚                â”‚                        â”‚                        â”‚
â”‚     â”‚                â”‚                â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                        â”‚
â”‚     â”‚                â”‚                â”‚ â”‚ 1. Validate      â”‚   â”‚                        â”‚
â”‚     â”‚                â”‚                â”‚ â”‚ 2. Create Entity â”‚   â”‚                        â”‚
â”‚     â”‚                â”‚                â”‚ â”‚ 3. Save to DB    â”‚   â”‚                        â”‚
â”‚     â”‚                â”‚                â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                        â”‚
â”‚     â”‚                â”‚                â”‚                        â”‚                        â”‚
â”‚     â”‚                â”‚                â”‚â”€â”€â”€â”€ Process â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                        â”‚
â”‚     â”‚                â”‚                â”‚                        â”‚                        â”‚
â”‚     â”‚                â”‚                â”‚â—€â”€â”€â”€ Result â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚
â”‚     â”‚                â”‚                â”‚                        â”‚                        â”‚
â”‚     â”‚                â”‚                â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                        â”‚
â”‚     â”‚                â”‚                â”‚ â”‚ 4. Update Status â”‚   â”‚                        â”‚
â”‚     â”‚                â”‚                â”‚ â”‚ 5. Publish Event â”‚   â”‚                        â”‚
â”‚     â”‚                â”‚                â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                        â”‚
â”‚     â”‚                â”‚                â”‚                        â”‚                        â”‚
â”‚     â”‚                â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚                        â”‚
â”‚     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚                        â”‚                        â”‚
â”‚     â”‚   200 OK       â”‚                â”‚                        â”‚                        â”‚
â”‚     â”‚                â”‚                â”‚                        â”‚                        â”‚
â”‚                                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Saga AkÄ±ÅŸÄ± (Orkestrasyon ile)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              SAGA Ã–DEME AKIÅI                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                         â”‚
â”‚  Orchestrator     Service Bus    PaymentService.Workers    PaymentService.Api           â”‚
â”‚      â”‚                â”‚                  â”‚                       â”‚                      â”‚
â”‚      â”‚                â”‚                  â”‚                       â”‚                      â”‚
â”‚      â”‚ ProcessPayment â”‚                  â”‚                       â”‚                      â”‚
â”‚      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                  â”‚                       â”‚                      â”‚
â”‚      â”‚                â”‚                  â”‚                       â”‚                      â”‚
â”‚      â”‚                â”‚  Trigger         â”‚                       â”‚                      â”‚
â”‚      â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                       â”‚                      â”‚
â”‚      â”‚                â”‚                  â”‚                       â”‚                      â”‚
â”‚      â”‚                â”‚                  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                      â”‚
â”‚      â”‚                â”‚                  â”‚ â”‚ 1. Parse Command â”‚  â”‚                      â”‚
â”‚      â”‚                â”‚                  â”‚ â”‚ 2. Map to DTO    â”‚  â”‚                      â”‚
â”‚      â”‚                â”‚                  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                      â”‚
â”‚      â”‚                â”‚                  â”‚                       â”‚                      â”‚
â”‚      â”‚                â”‚                  â”‚ Internal HTTP Call    â”‚                      â”‚
â”‚      â”‚                â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                      â”‚
â”‚      â”‚                â”‚                  â”‚                       â”‚                      â”‚
â”‚      â”‚                â”‚                  â”‚                       â”‚ Process Payment      â”‚
â”‚      â”‚                â”‚                  â”‚                       â”‚                      â”‚
â”‚      â”‚                â”‚                  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚
â”‚      â”‚                â”‚                  â”‚     Result            â”‚                      â”‚
â”‚      â”‚                â”‚                  â”‚                       â”‚                      â”‚
â”‚      â”‚                â”‚                  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                      â”‚
â”‚      â”‚                â”‚                  â”‚ â”‚ 3. Create Reply  â”‚  â”‚                      â”‚
â”‚      â”‚                â”‚                  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                      â”‚
â”‚      â”‚                â”‚                  â”‚                       â”‚                      â”‚
â”‚      â”‚                â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚                      â”‚
â”‚      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  Reply Queue     â”‚                       â”‚                      â”‚
â”‚      â”‚                â”‚                  â”‚                       â”‚                      â”‚
â”‚                                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Webhook AkÄ±ÅŸÄ±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              WEBHOOK AKIÅI                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                         â”‚
â”‚  Payment          PaymentService.Workers           PaymentService.Api     Service Bus   â”‚
â”‚  Provider                â”‚                               â”‚                    â”‚         â”‚
â”‚     â”‚                    â”‚                               â”‚                    â”‚         â”‚
â”‚     â”‚ POST /webhook      â”‚                               â”‚                    â”‚         â”‚
â”‚     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                               â”‚                    â”‚         â”‚
â”‚     â”‚                    â”‚                               â”‚                    â”‚         â”‚
â”‚     â”‚                    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                    â”‚         â”‚
â”‚     â”‚                    â”‚ â”‚ 1. Validate Signature    â”‚  â”‚                    â”‚         â”‚
â”‚     â”‚                    â”‚ â”‚ 2. Parse Event           â”‚  â”‚                    â”‚         â”‚
â”‚     â”‚                    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                    â”‚         â”‚
â”‚     â”‚                    â”‚                               â”‚                    â”‚         â”‚
â”‚     â”‚                    â”‚ Update Payment Status         â”‚                    â”‚         â”‚
â”‚     â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                    â”‚         â”‚
â”‚     â”‚                    â”‚                               â”‚                    â”‚         â”‚
â”‚     â”‚                    â”‚                               â”‚â”€â”€â”€ Event â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚         â”‚
â”‚     â”‚                    â”‚                               â”‚PaymentStatusChangedâ”‚         â”‚
â”‚     â”‚                    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚         â”‚
â”‚     â”‚                    â”‚        OK                     â”‚                    â”‚         â”‚
â”‚     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                               â”‚                    â”‚         â”‚
â”‚     â”‚    200 OK          â”‚                               â”‚                    â”‚         â”‚
â”‚     â”‚                    â”‚                               â”‚                    â”‚         â”‚
â”‚                                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Implementasyon DetaylarÄ±

### PaymentService.Core - IPaymentService

```csharp
// Core/Interfaces/IPaymentService.cs

namespace PaymentService.Core.Interfaces;

public interface IPaymentService
{
    Task<PaymentResult> ProcessPaymentAsync(ProcessPaymentRequest request, CancellationToken ct = default);
    Task<RefundResult> RefundPaymentAsync(RefundRequest request, CancellationToken ct = default);
    Task<PaymentDto?> GetByIdAsync(Guid paymentId, CancellationToken ct = default);
    Task<IEnumerable<PaymentDto>> GetByOrderIdAsync(Guid orderId, CancellationToken ct = default);
    Task UpdateStatusAsync(Guid paymentId, PaymentStatus status, CancellationToken ct = default);
}
```

### PaymentService.Api - Controller

```csharp
// Api/Controllers/PaymentsController.cs

namespace PaymentService.Api.Controllers;

[ApiController]
[Route("api/[controller]")]
public class PaymentsController : ControllerBase
{
    private readonly IPaymentService _paymentService;
    private readonly ILogger<PaymentsController> _logger;

    public PaymentsController(
        IPaymentService paymentService,
        ILogger<PaymentsController> logger)
    {
        _paymentService = paymentService;
        _logger = logger;
    }

    [HttpPost]
    [ProducesResponseType(typeof(PaymentResult), StatusCodes.Status200OK)]
    [ProducesResponseType(typeof(ProblemDetails), StatusCodes.Status400BadRequest)]
    public async Task<IActionResult> ProcessPayment(
        [FromBody] ProcessPaymentRequest request,
        CancellationToken ct)
    {
        _logger.LogInformation("Processing payment for order: {OrderId}", request.OrderId);

        var result = await _paymentService.ProcessPaymentAsync(request, ct);

        if (!result.Success)
        {
            return BadRequest(new ProblemDetails
            {
                Title = "Payment Failed",
                Detail = result.ErrorMessage,
                Instance = $"/api/payments/{result.PaymentId}"
            });
        }

        return Ok(result);
    }

    [HttpGet("{id:guid}")]
    [ProducesResponseType(typeof(PaymentDto), StatusCodes.Status200OK)]
    [ProducesResponseType(StatusCodes.Status404NotFound)]
    public async Task<IActionResult> GetPayment(Guid id, CancellationToken ct)
    {
        var payment = await _paymentService.GetByIdAsync(id, ct);

        if (payment == null)
        {
            return NotFound();
        }

        return Ok(payment);
    }

    [HttpPost("{id:guid}/refund")]
    [ProducesResponseType(typeof(RefundResult), StatusCodes.Status200OK)]
    [ProducesResponseType(typeof(ProblemDetails), StatusCodes.Status400BadRequest)]
    public async Task<IActionResult> RefundPayment(
        Guid id,
        [FromBody] RefundRequest request,
        CancellationToken ct)
    {
        request = request with { PaymentId = id };

        var result = await _paymentService.RefundPaymentAsync(request, ct);

        if (!result.Success)
        {
            return BadRequest(new ProblemDetails
            {
                Title = "Refund Failed",
                Detail = result.ErrorMessage
            });
        }

        return Ok(result);
    }

    [HttpPatch("{id:guid}/status")]
    [ProducesResponseType(StatusCodes.Status204NoContent)]
    public async Task<IActionResult> UpdateStatus(
        Guid id,
        [FromBody] UpdateStatusRequest request,
        CancellationToken ct)
    {
        await _paymentService.UpdateStatusAsync(id, request.Status, ct);
        return NoContent();
    }
}
```

### PaymentService.Workers - Saga Handler

```csharp
// Workers/Functions/SagaPaymentFunction.cs

namespace PaymentService.Workers.Functions;

public class SagaPaymentFunction
{
    private readonly HttpClient _apiClient;
    private readonly ServiceBusSender _replySender;
    private readonly ILogger<SagaPaymentFunction> _logger;

    public SagaPaymentFunction(
        IHttpClientFactory httpClientFactory,
        ServiceBusClient serviceBusClient,
        ILogger<SagaPaymentFunction> logger)
    {
        _apiClient = httpClientFactory.CreateClient("PaymentApi");
        _replySender = serviceBusClient.CreateSender("saga-reply-queue");
        _logger = logger;
    }

    [Function("HandleProcessPayment")]
    public async Task HandleProcessPayment(
        [ServiceBusTrigger("process-payment-queue")] ProcessPaymentCommand command)
    {
        _logger.LogInformation("Received ProcessPaymentCommand for Saga: {SagaId}", command.SagaId);

        PaymentProcessedReply reply;

        try
        {
            // API'ye internal HTTP call
            var request = MapToApiRequest(command);
            var response = await _apiClient.PostAsJsonAsync("/api/payments", request);

            if (response.IsSuccessStatusCode)
            {
                var result = await response.Content.ReadFromJsonAsync<PaymentResult>();

                reply = new PaymentProcessedReply(
                    SagaId: command.SagaId,
                    Success: result!.Success,
                    PaymentId: result.PaymentId,
                    TransactionId: result.TransactionId,
                    Error: result.ErrorMessage);
            }
            else
            {
                var problem = await response.Content.ReadFromJsonAsync<ProblemDetails>();

                reply = new PaymentProcessedReply(
                    SagaId: command.SagaId,
                    Success: false,
                    PaymentId: null,
                    TransactionId: null,
                    Error: problem?.Detail ?? "Unknown error");
            }
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error processing payment for Saga: {SagaId}", command.SagaId);

            reply = new PaymentProcessedReply(
                SagaId: command.SagaId,
                Success: false,
                PaymentId: null,
                TransactionId: null,
                Error: ex.Message);
        }

        await SendReplyAsync(reply);
    }

    [Function("HandleRefundPayment")]
    public async Task HandleRefundPayment(
        [ServiceBusTrigger("refund-payment-queue")] RefundPaymentCommand command)
    {
        _logger.LogInformation("Received RefundPaymentCommand for Saga: {SagaId}", command.SagaId);

        try
        {
            var request = new { Amount = command.Amount, Reason = command.Reason };
            var response = await _apiClient.PostAsJsonAsync(
                $"/api/payments/{command.PaymentId}/refund", request);

            if (response.IsSuccessStatusCode)
            {
                _logger.LogInformation("Refund completed for Saga: {SagaId}", command.SagaId);
            }
            else
            {
                _logger.LogWarning("Refund failed for Saga: {SagaId}", command.SagaId);
            }
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error refunding payment for Saga: {SagaId}", command.SagaId);
        }
    }

    private ProcessPaymentRequest MapToApiRequest(ProcessPaymentCommand command)
    {
        return new ProcessPaymentRequest
        {
            OrderId = command.OrderId,
            CustomerId = command.CustomerId,
            Amount = command.Amount,
            Currency = command.Currency,
            Method = command.PaymentMethod,
            CardNumber = command.CardNumber,
            ExpiryMonth = command.ExpiryMonth,
            ExpiryYear = command.ExpiryYear,
            Cvv = command.Cvv,
            CardHolderName = command.CardHolderName,
            CustomerEmail = command.CustomerEmail,
            CustomerIp = command.CustomerIp
        };
    }

    private async Task SendReplyAsync(PaymentProcessedReply reply)
    {
        var message = new ServiceBusMessage(JsonSerializer.SerializeToUtf8Bytes(reply))
        {
            ContentType = "application/json"
        };
        message.ApplicationProperties["MessageType"] = nameof(PaymentProcessedReply);

        await _replySender.SendMessageAsync(message);
    }
}
```

### PaymentService.Workers - Program.cs

```csharp
// Workers/Program.cs

using Azure.Messaging.ServiceBus;
using Microsoft.Azure.Functions.Worker;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Hosting;
using PaymentService.Core.Interfaces;
using PaymentService.Core.Services;
using PaymentService.Infrastructure;

var host = new HostBuilder()
    .ConfigureFunctionsWebApplication()
    .ConfigureServices((context, services) =>
    {
        var configuration = context.Configuration;

        services.AddApplicationInsightsTelemetryWorkerService();
        services.ConfigureFunctionsApplicationInsights();

        // HTTP Client for internal API calls
        services.AddHttpClient("PaymentApi", client =>
        {
            client.BaseAddress = new Uri(configuration["PaymentApiBaseUrl"] 
                ?? "http://localhost:5080");
        });

        // Service Bus
        var serviceBusConnection = configuration["ServiceBusConnection"];
        services.AddSingleton(new ServiceBusClient(serviceBusConnection));

        // Infrastructure (shared with API)
        services.AddInfrastructure(configuration);

        // Core services (shared with API)
        services.AddScoped<IPaymentService, PaymentService.Core.Services.PaymentService>();
    })
    .Build();

host.Run();
```

---

## Docker YapÄ±landÄ±rmasÄ±

### docker-compose.yml

```yaml
# docker-compose.yml

services:
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # PAYMENT SERVICE - API
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  payment-api:
    build:
      context: ./src/services/Payment
      dockerfile: PaymentService.Api/Dockerfile
    container_name: payment-api
    ports:
      - "5080:80"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ConnectionStrings__PaymentDb=Server=payment-db;Database=PaymentDb;...
      - ServiceBusConnection=${SERVICEBUS_CONNECTION}
    depends_on:
      - payment-db
      - servicebus-emulator
    networks:
      - saga-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:80/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # PAYMENT SERVICE - WORKERS
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  payment-workers:
    build:
      context: ./src/services/Payment
      dockerfile: PaymentService.Workers/Dockerfile
    container_name: payment-workers
    ports:
      - "7073:80"
    environment:
      - AzureWebJobsStorage=UseDevelopmentStorage=true
      - ServiceBusConnection=${SERVICEBUS_CONNECTION}
      - PaymentApiBaseUrl=http://payment-api:80
    depends_on:
      - payment-api
      - azurite
      - servicebus-emulator
    networks:
      - saga-network

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # PAYMENT DATABASE
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  payment-db:
    image: mcr.microsoft.com/mssql/server:2022-latest
    container_name: payment-db
    ports:
      - "1475:1433"
    environment:
      - ACCEPT_EULA=Y
      - SA_PASSWORD=YourStrong@Passw0rd
    volumes:
      - payment_db_data:/var/opt/mssql
    networks:
      - saga-network

volumes:
  payment_db_data:

networks:
  saga-network:
    driver: bridge
```

### PaymentService.Api/Dockerfile

```dockerfile
FROM mcr.microsoft.com/dotnet/aspnet:8.0 AS base
WORKDIR /app
EXPOSE 80

FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR /src

COPY ["PaymentService.Core/PaymentService.Core.csproj", "PaymentService.Core/"]
COPY ["PaymentService.Infrastructure/PaymentService.Infrastructure.csproj", "PaymentService.Infrastructure/"]
COPY ["PaymentService.Api/PaymentService.Api.csproj", "PaymentService.Api/"]

RUN dotnet restore "PaymentService.Api/PaymentService.Api.csproj"

COPY . .
WORKDIR "/src/PaymentService.Api"
RUN dotnet build -c Release -o /app/build

FROM build AS publish
RUN dotnet publish -c Release -o /app/publish

FROM base AS final
WORKDIR /app
COPY --from=publish /app/publish .
ENTRYPOINT ["dotnet", "PaymentService.Api.dll"]
```

### PaymentService.Workers/Dockerfile

```dockerfile
FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR /src

COPY ["PaymentService.Core/PaymentService.Core.csproj", "PaymentService.Core/"]
COPY ["PaymentService.Infrastructure/PaymentService.Infrastructure.csproj", "PaymentService.Infrastructure/"]
COPY ["PaymentService.Workers/PaymentService.Workers.csproj", "PaymentService.Workers/"]

RUN dotnet restore "PaymentService.Workers/PaymentService.Workers.csproj"

COPY . .
WORKDIR "/src/PaymentService.Workers"
RUN dotnet build -c Release -o /app/build
RUN dotnet publish -c Release -o /app/publish

FROM mcr.microsoft.com/azure-functions/dotnet-isolated:4-dotnet-isolated8.0 AS final
WORKDIR /home/site/wwwroot
COPY --from=build /app/publish .
ENV AzureWebJobsScriptRoot=/home/site/wwwroot
```

---

## Deployment Stratejisi

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              DEPLOYMENT STRATEJÄ°SÄ°                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                         â”‚
â”‚   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—   â”‚
â”‚   â•‘                              LOCAL (Development)                                â•‘   â”‚
â”‚   â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£   â”‚
â”‚   â•‘                                                                                 â•‘   â”‚
â”‚   â•‘   docker-compose up -d payment-api payment-workers payment-db                   â•‘   â”‚
â”‚   â•‘                                                                                 â•‘   â”‚
â”‚   â•‘   Payment API:     http://localhost:5080                                        â•‘   â”‚
â”‚   â•‘   Payment Workers: http://localhost:7073                                        â•‘   â”‚
â”‚   â•‘   Payment DB:      localhost:1475                                               â•‘   â”‚
â”‚   â•‘                                                                                 â•‘   â”‚
â”‚   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                                         â”‚
â”‚   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—   â”‚
â”‚   â•‘                              AZURE (Production)                                 â•‘   â”‚
â”‚   â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£   â”‚
â”‚   â•‘                                                                                 â•‘   â”‚
â”‚   â•‘   Payment API:     Azure App Service / AKS                                      â•‘   â”‚
â”‚   â•‘   Payment Workers: Azure Functions (Consumption/Premium Plan)                   â•‘   â”‚
â”‚   â•‘   Payment DB:      Azure SQL Database                                           â•‘   â”‚
â”‚   â•‘   Service Bus:     Azure Service Bus                                            â•‘   â”‚
â”‚   â•‘                                                                                 â•‘   â”‚
â”‚   â•‘   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘   â”‚
â”‚   â•‘   â”‚                                                                         â”‚   â•‘   â”‚
â”‚   â•‘   â”‚   API                              WORKERS                              â”‚   â•‘   â”‚
â”‚   â•‘   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚   â•‘   â”‚
â”‚   â•‘   â”‚   â”‚ App Service  â”‚                â”‚ Azure Func   â”‚                      â”‚   â•‘   â”‚
â”‚   â•‘   â”‚   â”‚ or AKS Pod   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Premium Plan â”‚                      â”‚   â•‘   â”‚
â”‚   â•‘   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  Internal      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚   â•‘   â”‚
â”‚   â•‘   â”‚         â”‚            VNET               â”‚                               â”‚   â•‘   â”‚
â”‚   â•‘   â”‚         â”‚                               â”‚                               â”‚   â•‘   â”‚
â”‚   â•‘   â”‚         â–¼                               â–¼                               â”‚   â•‘   â”‚
â”‚   â•‘   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚   â•‘   â”‚
â”‚   â•‘   â”‚   â”‚ Azure SQL    â”‚                â”‚ Service Bus  â”‚                      â”‚   â•‘   â”‚
â”‚   â•‘   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚   â•‘   â”‚
â”‚   â•‘   â”‚                                                                         â”‚   â•‘   â”‚
â”‚   â•‘   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘   â”‚
â”‚   â•‘                                                                                 â•‘   â”‚
â”‚   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ã–zet

| BileÅŸen | Teknoloji | Rol |
|---------|-----------|-----|
| **PaymentService.Core** | .NET Class Library | Shared iÅŸ mantÄ±ÄŸÄ±, arayÃ¼zler |
| **PaymentService.Infrastructure** | .NET Class Library | DB, providers, Service Bus |
| **PaymentService.Api** | ASP.NET Core | REST API, validasyon, middleware |
| **PaymentService.Workers** | Azure Functions | Saga handlers, webhooks, jobs |

### Avantajlar

âœ… Clean Architecture uyumlu
âœ… Test edilebilir katmanlar
âœ… Saga entegrasyonu kolay
âœ… REST API + Event-driven
âœ… BaÄŸÄ±msÄ±z Ã¶lÃ§ekleme
âœ… PCI DSS uyumluluk dÃ¼zenlemeleri kolay
